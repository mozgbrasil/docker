#!/usr/bin/env bash

#

set_vars(){
    GIT=`which git` > /dev/null
    PHP_BIN=`which php`
    OS=`uname -s`
    REV=`uname -r`
    MACH=`uname -m`
    BASE_PATH_USER=~

    # Define text styles
    BOLD=`tput bold`
    NORMAL=`tput sgr0`

    # Reset
    RESETCOLOR='\e[0m'       # Text Reset

    # Regular Colors
    BLACK='\e[0;30m'        # Black
    RED='\e[0;31m'          # Red
    GREEN='\e[0;32m'        # Green
    YELLOW='\e[0;33m'       # Yellow
    BLUE='\e[0;34m'         # Blue
    PURPLE='\e[0;35m'       # Purple
    CYAN='\e[0;36m'         # Cyan
    WHITE='\e[0;37m'        # White

    # Background
    ONBLACK='\e[40m'       # Black
    ONRED='\e[41m'         # Red
    ONGREEN='\e[42m'       # Green
    ONYELLOW='\e[43m'      # Yellow
    ONBLUE='\e[44m'        # Blue
    ONPURPLE='\e[45m'      # Purple
    ONCYAN='\e[46m'        # Cyan
    ONWHITE='\e[47m'       # White

    # Nice defaults
    NOW_2_FILE=$(date +%Y-%m-%d_%H-%M-%S)
    DATE_EN_US=$(date '+%Y-%m-%d %H:%M:%S')
    DATE_PT_BR=$(date '+%d/%m/%Y %H:%M:%S')
}

set_vars

echo -e "${ONPURPLE} '2018-05-10 16:39' ${NORMAL}"
echo -e "${ONWHITE} - ${NORMAL}"

#

echo -e "${ONPURPLE} test' ${NORMAL}"

n98

echo -e "${ONPURPLE} Exit' ${NORMAL}"
exit 0

#

echo -e "${ONPURPLE} 'composer create-project' ${NORMAL}"

if [ $@ ]; then
  composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition:$1 .
else
  composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition .
fi

echo -e "${ONPURPLE} 'Change Permissions' ${NORMAL}"

chmod u+w -R ./var ./vendor ./pub/static ./pub/media ./app/etc

chmod u+x ./bin/magento

echo -e "${ONPURPLE} 'Install' ${NORMAL}"

php -f ./bin/magento setup:install --base-url=http://localhost/magento2/ \
  --db-host=db \
  --db-name=magento2 \
  --db-user=root \
  --db-password=root \
  --admin-firstname=Magento \
  --admin-lastname=Commerce \
  --admin-email=user@example.com \
  --admin-user=admin \
  --admin-password=123456a \
  --language=pt_BR \
  --currency=BRL \
  --timezone=America/Sao_Paulo \
  --use-rewrites=1 \
  --backend-frontname=admin \
  --use-sample-data

echo -e "${ONPURPLE} 'files' ${NORMAL}"

mv ./app/etc/env.php ./app/etc/env.original.php
cp -rv /var/www/env.sample.php ./app/etc/env.php
cp ~/.composer/auth.json var/composer_home/auth.json

echo -e "${ONPURPLE} 'bin/magento' ${NORMAL}"

php -f ./bin/magento indexer:set-mode schedule
php -f ./bin/magento sampledata:deploy
php -f ./bin/magento setup:upgrade
php -f ./bin/magento indexer:reindex
php -f ./bin/magento cache:flush
php -f ./bin/magento deploy:mode:set production

echo -e "${ONPURPLE} n98' ${NORMAL}"

n98 cron:install

echo -e "${ONPURPLE} 'add-ons' ${NORMAL}"

mv package.json.sample package.json
mv Gruntfile.js.sample Gruntfile.js
npm i

echo -e "${ONPURPLE} 'composer dump-autoload' ${NORMAL}"

composer dump-autoload -o

echo -e "${ONPURPLE} 'FIM' ${NORMAL}"

echo "
===================== ðŸš€ Done ðŸš€ ===================

      Magento 2 Installed successfully!

      ðŸŒŽ Admin: http://localhost/magento2/admin
      ðŸ‘¤ User: admin
      ðŸ”‘ Password: 123456a

===================== ðŸš€ Done ðŸš€ ==================="
